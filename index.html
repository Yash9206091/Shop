<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kirana Manager - Smart Store Management</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Firebase SDK v9 -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --secondary: #10b981;
            --secondary-dark: #0da271;
            --danger: #ef4444;
            --warning: #f59e0b;
            --success: #10b981;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray: #64748b;
            --gray-light: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --radius: 12px;
            --radius-sm: 8px;
        }

        body {
            background-color: #f1f5f9;
            color: var(--dark);
            max-width: 100vw;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Login/Register Screen */
        #login-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        }

        .login-container {
            background-color: white;
            border-radius: var(--radius);
            padding: 40px 30px;
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .login-logo-icon {
            background-color: var(--primary);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
        }

        .login-logo-text {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark);
        }

        .login-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 30px;
            color: var(--dark);
        }

        .login-form .form-group {
            margin-bottom: 25px;
            text-align: left;
        }

        .login-form .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .login-form .form-input {
            width: 100%;
            padding: 16px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--gray-light);
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .login-form .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .login-btn {
            width: 100%;
            padding: 16px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 10px;
        }

        .login-btn:hover {
            background-color: var(--primary-dark);
        }

        .login-footer {
            margin-top: 30px;
            color: var(--gray);
            font-size: 0.9rem;
        }

        .register-link {
            margin-top: 20px;
            color: var(--primary);
            cursor: pointer;
            text-decoration: underline;
        }

        .error-message {
            color: var(--danger);
            background-color: rgba(239, 68, 68, 0.1);
            padding: 10px;
            border-radius: var(--radius-sm);
            margin-bottom: 20px;
            display: none;
        }

        /* Main App (hidden initially) */
        #main-app {
            display: none;
            min-height: 100vh;
            padding-bottom: 80px;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            font-size: 1.3rem;
        }

        .logo-icon {
            background-color: white;
            color: var(--primary);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: white;
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }

        /* Main Content */
        .main-content {
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        /* Screen Container */
        .screen {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background-color: white;
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--dark);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background-color: white;
            border-radius: var(--radius);
            padding: 18px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .stat-card:nth-child(1) { border-top: 5px solid var(--primary); }
        .stat-card:nth-child(2) { border-top: 5px solid var(--secondary); }
        .stat-card:nth-child(3) { border-top: 5px solid var(--warning); }
        .stat-card:nth-child(4) { border-top: 5px solid var(--danger); }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 5px 0;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--gray);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .stat-trend {
            font-size: 0.8rem;
            padding: 3px 8px;
            border-radius: 20px;
            margin-top: 5px;
            display: inline-block;
            width: fit-content;
        }

        .trend-up { background-color: rgba(16, 185, 129, 0.1); color: var(--success); }
        .trend-down { background-color: rgba(239, 68, 68, 0.1); color: var(--danger); }

        /* Charts */
        .chart-container {
            position: relative;
            height: 250px;
            width: 100%;
            margin: 15px 0;
        }

        /* Transaction List */
        .transaction-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background-color: white;
            border-radius: var(--radius-sm);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border-left: 5px solid var(--success);
            transition: transform 0.2s;
        }

        .transaction-item.debit {
            border-left-color: var(--danger);
        }

        .transaction-item:hover {
            transform: translateY(-2px);
        }

        .transaction-info h4 {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .transaction-info p {
            font-size: 0.9rem;
            color: var(--gray);
        }

        .transaction-amount {
            font-weight: 700;
            font-size: 1.2rem;
        }

        .transaction-amount.credit {
            color: var(--success);
        }

        .transaction-amount.debit {
            color: var(--danger);
        }

        /* Buttons */
        .btn {
            padding: 14px 20px;
            border-radius: var(--radius-sm);
            border: none;
            font-weight: 600;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-secondary {
            background-color: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background-color: var(--secondary-dark);
        }

        .btn-block {
            width: 100%;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 14px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--gray-light);
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .select-input {
            width: 100%;
            padding: 14px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--gray-light);
            font-size: 1rem;
            background-color: white;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 14px center;
            background-size: 16px;
        }

        /* Input Groups */
        .input-group {
            display: flex;
            gap: 10px;
        }

        .input-group .form-input {
            flex: 1;
        }

        /* Tabs */
        .tabs {
            display: flex;
            background-color: var(--gray-light);
            border-radius: var(--radius-sm);
            padding: 5px;
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            border-radius: var(--radius-sm);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            background: transparent;
        }

        .tab.active {
            background-color: white;
            box-shadow: var(--shadow);
        }

        /* Bottom Navigation - Simplified to 3 items */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: white;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 12px 0;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--gray);
            text-decoration: none;
            flex: 1;
            padding: 8px 0;
            transition: all 0.2s;
            font-size: 0.9rem;
            border: none;
            background: none;
            cursor: pointer;
        }

        .nav-item.active {
            color: var(--primary);
        }

        .nav-icon {
            font-size: 1.5rem;
            margin-bottom: 4px;
        }

        /* Insights Cards */
        .insight-card {
            background-color: white;
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border-left: 5px solid var(--primary);
        }

        .insight-card.warning { border-left-color: var(--warning); }
        .insight-card.success { border-left-color: var(--success); }
        .insight-card.danger { border-left-color: var(--danger); }

        .insight-title {
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .insight-text {
            color: var(--gray);
            line-height: 1.5;
        }

        /* Search Bar */
        .search-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            padding: 14px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--gray-light);
            font-size: 1rem;
        }

        .search-btn {
            padding: 14px 20px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            background-color: white;
            padding: 15px 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border-left: 5px solid var(--success);
            z-index: 1000;
            animation: slideIn 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 300px;
        }

        .notification.hidden {
            display: none;
        }

        /* Currency Symbol */
        .currency::before {
            content: '₹';
            margin-right: 2px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: white;
            border-radius: var(--radius);
            padding: 25px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: var(--dark);
        }

        /* Date Filter */
        .date-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .date-filter input {
            flex: 1;
            padding: 12px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--gray-light);
        }

        /* Transaction Summary */
        .transaction-summary {
            display: flex;
            justify-content: space-between;
            background-color: var(--light);
            padding: 15px;
            border-radius: var(--radius-sm);
            margin-bottom: 20px;
        }

        .summary-item {
            text-align: center;
        }

        .summary-label {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 5px;
        }

        .summary-value {
            font-size: 1.3rem;
            font-weight: 700;
        }

        .summary-value.credit {
            color: var(--success);
        }

        .summary-value.debit {
            color: var(--danger);
        }

        .summary-value.net {
            color: var(--primary);
        }

        /* Responsive */
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .main-content {
                padding: 15px;
            }
            
            .card {
                padding: 16px;
            }
            
            .login-container {
                padding: 30px 20px;
            }
            
            .login-logo {
                flex-direction: column;
                gap: 10px;
            }
            
            .transaction-summary {
                flex-direction: column;
                gap: 15px;
            }
            
            .summary-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
        }

        /* Animation for notifications */
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* Logout Button */
        .logout-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
            margin-left: 15px;
        }
        
        /* Loader */
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Demo Credentials */
        .demo-credentials {
            background-color: #e8f5e9;
            border-left: 5px solid #4caf50;
            padding: 15px;
            margin-top: 15px;
            border-radius: var(--radius-sm);
        }
        
        .demo-credentials h4 {
            color: #2e7d32;
            margin-bottom: 10px;
        }
        
        /* Quick Add Buttons */
        .quick-add-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .quick-add-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        .quick-add-btn.credit {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success);
            border: 2px solid var(--success);
        }
        
        .quick-add-btn.debit {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger);
            border: 2px solid var(--danger);
        }
        
        .quick-add-btn:hover {
            transform: translateY(-3px);
        }
        
        /* Category Tags */
        .category-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .category-tag {
            background-color: var(--gray-light);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .category-tag.active {
            background-color: var(--primary);
            color: white;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen">
        <div class="login-container">
            <div class="login-logo">
                <div class="login-logo-icon">
                    <i class="fas fa-store"></i>
                </div>
                <div class="login-logo-text">Kirana Manager</div>
            </div>
            
            <div class="login-title">Sign in to Your Store</div>
            
            <div class="error-message" id="login-error"></div>
            
            <form class="login-form" id="login-form">
                <div class="form-group">
                    <label class="form-label">Email *</label>
                    <input type="email" class="form-input" id="login-email" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password *</label>
                    <input type="password" class="form-input" id="login-password" placeholder="Enter password" required minlength="6">
                </div>
                
                <button type="submit" class="login-btn" id="login-submit-btn">
                    <i class="fas fa-sign-in-alt"></i> Sign In
                </button>
                
                <div class="register-link" id="show-register">
                    Don't have an account? Register here
                </div>
            </form>
            
            <form class="login-form" id="register-form" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Store Name *</label>
                    <input type="text" class="form-input" id="register-store-name" placeholder="Enter store name" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Owner Name *</label>
                    <input type="text" class="form-input" id="register-owner-name" placeholder="Enter owner name" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email *</label>
                    <input type="email" class="form-input" id="register-email" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password *</label>
                    <input type="password" class="form-input" id="register-password" placeholder="Enter password (min 6 characters)" required minlength="6">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Confirm Password *</label>
                    <input type="password" class="form-input" id="register-confirm-password" placeholder="Confirm password" required minlength="6">
                </div>
                
                <button type="submit" class="login-btn" id="register-submit-btn">
                    <i class="fas fa-user-plus"></i> Create Account
                </button>
                
                <div class="register-link" id="show-login">
                    Already have an account? Sign in here
                </div>
            </form>
            
            <div class="demo-credentials">
                <h4>Demo Credentials</h4>
                <p><strong>Email:</strong> demo@kirana.com</p>
                <p><strong>Password:</strong> kirana123</p>
                <p style="margin-top: 10px; font-size: 0.8rem;">Use these credentials for testing or click "Register here" to create your own account</p>
            </div>
            
            <div class="login-footer">
                <p>For Kirana store owners • Simple Credit/Debit Management</p>
            </div>
        </div>
    </div>

    <!-- Main App (hidden initially) -->
    <div id="main-app">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-store"></i>
                </div>
                <span id="store-name-header">Kirana Manager</span>
            </div>
            <div class="user-profile">
                <div class="user-avatar" id="user-avatar">SK</div>
                <div>
                    <div id="owner-name-header" style="font-weight: 600;">Store Owner</div>
                    <div id="user-email" style="font-size: 0.8rem;">Loading...</div>
                </div>
                <button class="logout-btn" id="logout-btn" title="Logout">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Home Screen - Analysis -->
            <div id="home-screen" class="screen active">
                <div class="card">
                    <div class="card-title">
                        <span>Today's Analysis</span>
                        <span id="current-date" style="font-size: 0.9rem; color: var(--gray);"></span>
                    </div>
                    
                    <div class="transaction-summary">
                        <div class="summary-item">
                            <div class="summary-label">Credit</div>
                            <div id="today-credit" class="summary-value credit currency">0</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Debit</div>
                            <div id="today-debit" class="summary-value debit currency">0</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Net Profit</div>
                            <div id="today-profit" class="summary-value net currency">0</div>
                        </div>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">
                                <i class="fas fa-arrow-down"></i>
                                Total Credit
                            </div>
                            <div id="total-credit" class="stat-value currency">0</div>
                            <div class="stat-trend trend-up">
                                <i class="fas fa-rupee-sign"></i> Sales & Income
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-label">
                                <i class="fas fa-arrow-up"></i>
                                Total Debit
                            </div>
                            <div id="total-debit" class="stat-value currency">0</div>
                            <div class="stat-trend trend-down">
                                <i class="fas fa-shopping-cart"></i> Expenses & Purchases
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-label">
                                <i class="fas fa-chart-line"></i>
                                Monthly Profit
                            </div>
                            <div id="monthly-profit" class="stat-value currency">0</div>
                            <div class="stat-trend trend-up">
                                <i class="fas fa-wallet"></i> Net Earnings
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-label">
                                <i class="fas fa-calendar-alt"></i>
                                This Month
                            </div>
                            <div id="month-transactions" class="stat-value">0</div>
                            <div class="stat-trend trend-up">
                                <i class="fas fa-exchange-alt"></i> Transactions
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">
                        <span>Income vs Expenses (Last 7 Days)</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="incomeExpenseChart"></canvas>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">
                        <span>Top Categories</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">
                        <span>Recent Transactions</span>
                        <button class="btn" style="padding: 5px 10px; font-size: 0.8rem;" id="view-all-transactions">View All</button>
                    </div>
                    <div id="recent-transactions" class="transaction-list">
                        <div class="empty-state">
                            <i class="fas fa-exchange-alt empty-state-icon"></i>
                            <div class="empty-state-title">No transactions yet</div>
                            <p>Add your first credit or debit transaction</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Credit Screen -->
            <div id="credit-screen" class="screen">
                <div class="card">
                    <div class="card-title">
                        <span>Add Credit (Income)</span>
                        <i class="fas fa-arrow-down" style="color: var(--success);"></i>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Amount (₹) *</label>
                        <input type="number" class="form-input" id="credit-amount" placeholder="Enter amount" min="1" step="0.01" inputmode="decimal" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Category *</label>
                        <select class="select-input" id="credit-category">
                            <option value="">Select Category</option>
                            <option value="Sales">Sales</option>
                            <option value="Cash Sale">Cash Sale</option>
                            <option value="UPI Payment">UPI Payment</option>
                            <option value="Credit Card">Credit Card</option>
                            <option value="Online Order">Online Order</option>
                            <option value="Investment">Investment</option>
                            <option value="Other Income">Other Income</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Description *</label>
                        <input type="text" class="form-input" id="credit-description" placeholder="What is this income for?">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Customer Name (Optional)</label>
                        <input type="text" class="form-input" id="credit-customer" placeholder="Enter customer name">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Payment Method *</label>
                        <div style="display: flex; gap: 10px;">
                            <button type="button" class="tab active" style="flex: 1;" data-payment="cash">Cash</button>
                            <button type="button" class="tab" style="flex: 1;" data-payment="upi">UPI</button>
                            <button type="button" class="tab" style="flex: 1;" data-payment="card">Card</button>
                            <button type="button" class="tab" style="flex: 1;" data-payment="online">Online</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Date</label>
                        <input type="date" class="form-input" id="credit-date" value="">
                    </div>
                    
                    <button class="btn btn-secondary btn-block" id="add-credit-btn">
                        <i class="fas fa-plus-circle"></i> Add Credit Entry
                    </button>
                </div>
                
                <div class="quick-add-buttons">
                    <button class="quick-add-btn credit" data-amount="100">
                        <i class="fas fa-rupee-sign"></i>
                        <span>₹100 Sale</span>
                    </button>
                    <button class="quick-add-btn credit" data-amount="500">
                        <i class="fas fa-rupee-sign"></i>
                        <span>₹500 Sale</span>
                    </button>
                    <button class="quick-add-btn credit" data-amount="1000">
                        <i class="fas fa-rupee-sign"></i>
                        <span>₹1000 Sale</span>
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-title">
                        <span>Today's Credit Entries</span>
                        <span id="today-credit-count" class="alert-badge badge-low">0</span>
                    </div>
                    <div id="today-credit-list" class="transaction-list">
                        <div class="empty-state">
                            <i class="fas fa-arrow-down empty-state-icon"></i>
                            <div class="empty-state-title">No credit entries today</div>
                            <p>Add your first credit entry above</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Debit Screen -->
            <div id="debit-screen" class="screen">
                <div class="card">
                    <div class="card-title">
                        <span>Add Debit (Expense)</span>
                        <i class="fas fa-arrow-up" style="color: var(--danger);"></i>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Amount (₹) *</label>
                        <input type="number" class="form-input" id="debit-amount" placeholder="Enter amount" min="1" step="0.01" inputmode="decimal" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Category *</label>
                        <select class="select-input" id="debit-category">
                            <option value="">Select Category</option>
                            <option value="Purchase">Purchase</option>
                            <option value="Groceries">Groceries</option>
                            <option value="Rent">Rent</option>
                            <option value="Electricity">Electricity</option>
                            <option value="Salary">Salary</option>
                            <option value="Maintenance">Maintenance</option>
                            <option value="Transport">Transport</option>
                            <option value="Other Expense">Other Expense</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Description *</label>
                        <input type="text" class="form-input" id="debit-description" placeholder="What is this expense for?">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Vendor/Supplier (Optional)</label>
                        <input type="text" class="form-input" id="debit-vendor" placeholder="Enter vendor/supplier name">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Payment Method *</label>
                        <div style="display: flex; gap: 10px;">
                            <button type="button" class="tab active" style="flex: 1;" data-payment="cash">Cash</button>
                            <button type="button" class="tab" style="flex: 1;" data-payment="upi">UPI</button>
                            <button type="button" class="tab" style="flex: 1;" data-payment="card">Card</button>
                            <button type="button" class="tab" style="flex: 1;" data-payment="online">Online</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Date</label>
                        <input type="date" class="form-input" id="debit-date" value="">
                    </div>
                    
                    <button class="btn btn-primary btn-block" id="add-debit-btn">
                        <i class="fas fa-minus-circle"></i> Add Debit Entry
                    </button>
                </div>
                
                <div class="quick-add-buttons">
                    <button class="quick-add-btn debit" data-amount="50">
                        <i class="fas fa-rupee-sign"></i>
                        <span>₹50 Expense</span>
                    </button>
                    <button class="quick-add-btn debit" data-amount="200">
                        <i class="fas fa-rupee-sign"></i>
                        <span>₹200 Expense</span>
                    </button>
                    <button class="quick-add-btn debit" data-amount="1000">
                        <i class="fas fa-rupee-sign"></i>
                        <span>₹1000 Expense</span>
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-title">
                        <span>Today's Debit Entries</span>
                        <span id="today-debit-count" class="alert-badge badge-low">0</span>
                    </div>
                    <div id="today-debit-list" class="transaction-list">
                        <div class="empty-state">
                            <i class="fas fa-arrow-up empty-state-icon"></i>
                            <div class="empty-state-title">No debit entries today</div>
                            <p>Add your first debit entry above</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Notification -->
        <div class="notification hidden" id="notification">
            <i class="fas fa-check-circle" style="color: var(--success); font-size: 1.2rem;"></i>
            <div>
                <div id="notification-title" style="font-weight: 600;">Success!</div>
                <div id="notification-message" style="font-size: 0.9rem;">Operation completed successfully</div>
            </div>
        </div>
        
        <!-- Bottom Navigation - Simplified to 3 items -->
        <div class="bottom-nav">
            <button class="nav-item active" data-screen="home-screen">
                <i class="fas fa-chart-pie nav-icon"></i>
                <span>Analysis</span>
            </button>
            
            <button class="nav-item" data-screen="credit-screen">
                <i class="fas fa-arrow-down nav-icon"></i>
                <span>Credit</span>
            </button>
            
            <button class="nav-item" data-screen="debit-screen">
                <i class="fas fa-arrow-up nav-icon"></i>
                <span>Debit</span>
            </button>
        </div>
    </div>

    <script>
        // Firebase Configuration - Your Firebase Project
        document.addEventListener('contextmenu', event => event.preventDefault());
        const firebaseConfig = {
            apiKey: "AIzaSyDgI7ZANjk83BpgQecR8m6qwBYO4eQ-4nY",
            authDomain: "kirana-shop-d71b9.firebaseapp.com",
            databaseURL: "https://kirana-shop-d71b9-default-rtdb.firebaseio.com",
            projectId: "kirana-shop-d71b9",
            storageBucket: "kirana-shop-d71b9.firebasestorage.app",
            messagingSenderId: "414947666204",
            appId: "1:414947666204:web:234289377116cad01732d9",
            measurementId: "G-15L7X1V4J2"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();

        // Main App State
        const KiranaApp = {
            // Chart instances
            charts: {},
            
            // Current user data
            currentUser: null,
            userId: null,
            
            // Demo mode flag
            demoMode: false,
            
            // App data structure - Simplified
            data: {
                credits: [],
                debits: [],
                storeInfo: {
                    name: "My Kirana Store",
                    owner: "Store Owner",
                    address: "Enter your store address",
                    gst: "22XXXXX1234X1X5",
                    email: ""
                }
            },
            
            // Initialize app
            init: function() {
                this.setupEventListeners();
                this.updateCurrentDate();
                
                // Set today's date in form inputs
                const today = this.getTodayDate();
                document.getElementById('credit-date').value = today;
                document.getElementById('debit-date').value = today;
                
                // Check if user is already logged in
                this.checkAuthState();
            },
            
            // Check authentication state
            checkAuthState: function() {
                auth.onAuthStateChanged((user) => {
                    if (user) {
                        console.log('User is signed in:', user.email);
                        this.currentUser = user;
                        this.userId = user.uid;
                        this.showMainApp();
                        this.loadUserData();
                    } else {
                        console.log('No user signed in');
                        this.showLoginScreen();
                        
                        // Check for demo mode
                        if (localStorage.getItem('kiranaDemoMode') === 'true') {
                            this.enableDemoMode();
                        }
                    }
                }, (error) => {
                    console.error('Auth state change error:', error);
                    this.showLoginScreen();
                    
                    // If Firebase auth fails, enable demo mode
                    if (error.code === 'auth/network-request-failed' || 
                        error.code === 'auth/internal-error' ||
                        error.message.includes('auth/')) {
                        this.enableDemoMode();
                    }
                });
            },
            
            // Enable demo mode (fallback when Firebase auth fails)
            enableDemoMode: function() {
                this.demoMode = true;
                this.userId = 'demo-user';
                this.currentUser = { email: 'demo@kirana.com', uid: 'demo-user' };
                
                // Create demo data structure
                this.data.storeInfo = {
                    name: "Demo Kirana Store",
                    owner: "Demo User",
                    address: "123 Demo Street, Demo City",
                    gst: "22DEMO1234D1M0",
                    email: "demo@kirana.com"
                };
                
                // Load demo data from localStorage
                this.loadDemoData();
                
                // Show main app in demo mode
                this.showMainApp();
                this.showNotification('Demo Mode', 'Using demo mode. Data is stored locally.', 'info');
            },
            
            // Load demo data from localStorage
            loadDemoData: function() {
                const demoData = localStorage.getItem('kiranaDemoData');
                if (demoData) {
                    try {
                        const parsedData = JSON.parse(demoData);
                        this.data.credits = parsedData.credits || [];
                        this.data.debits = parsedData.debits || [];
                        if (parsedData.storeInfo) {
                            this.data.storeInfo = { ...this.data.storeInfo, ...parsedData.storeInfo };
                        }
                    } catch (e) {
                        console.error('Error loading demo data:', e);
                    }
                }
            },
            
            // Save demo data to localStorage
            saveDemoData: function() {
                if (!this.demoMode) return;
                
                const demoData = {
                    credits: this.data.credits,
                    debits: this.data.debits,
                    storeInfo: this.data.storeInfo
                };
                
                localStorage.setItem('kiranaDemoData', JSON.stringify(demoData));
                localStorage.setItem('kiranaDemoMode', 'true');
            },
            
            // Load user data from Firebase
            loadUserData: function() {
                if (this.demoMode) {
                    this.updateUserInfo();
                    this.renderHomeScreen();
                    this.renderCreditScreen();
                    this.renderDebitScreen();
                    return;
                }
                
                if (!this.userId) return;
                
                // Load store info
                database.ref(`users/${this.userId}/storeInfo`).once('value')
                    .then((snapshot) => {
                        if (snapshot.exists()) {
                            this.data.storeInfo = snapshot.val();
                        }
                        // Update UI with user info
                        this.updateUserInfo();
                    })
                    .catch((error) => {
                        console.error("Error loading store info:", error);
                        this.updateUserInfo();
                    });
                
                // Load credits
                this.loadCredits();
                
                // Load debits
                this.loadDebits();
            },
            
            // Load credits from Firebase
            loadCredits: function() {
                if (this.demoMode) {
                    // Credits are already loaded from localStorage
                    return;
                }
                
                if (!this.userId) return;
                
                database.ref(`users/${this.userId}/credits`).on('value', (snapshot) => {
                    this.data.credits = [];
                    if (snapshot.exists()) {
                        const creditsData = snapshot.val();
                        Object.keys(creditsData).forEach((key) => {
                            this.data.credits.push({
                                id: key,
                                ...creditsData[key]
                            });
                        });
                    }
                    this.renderHomeScreen();
                    this.renderCreditScreen();
                }, (error) => {
                    console.error("Error loading credits:", error);
                });
            },
            
            // Load debits from Firebase
            loadDebits: function() {
                if (this.demoMode) {
                    // Debits are already loaded from localStorage
                    return;
                }
                
                if (!this.userId) return;
                
                database.ref(`users/${this.userId}/debits`).on('value', (snapshot) => {
                    this.data.debits = [];
                    if (snapshot.exists()) {
                        const debitsData = snapshot.val();
                        Object.keys(debitsData).forEach((key) => {
                            this.data.debits.push({
                                id: key,
                                ...debitsData[key]
                            });
                        });
                    }
                    this.renderHomeScreen();
                    this.renderDebitScreen();
                }, (error) => {
                    console.error("Error loading debits:", error);
                });
            },
            
            // Show login screen
            showLoginScreen: function() {
                document.getElementById('login-screen').style.display = 'flex';
                document.getElementById('main-app').style.display = 'none';
                document.getElementById('login-form').style.display = 'block';
                document.getElementById('register-form').style.display = 'none';
                document.getElementById('login-error').style.display = 'none';
            },
            
            // Show main app
            showMainApp: function() {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('main-app').style.display = 'block';
                this.setupCharts();
                this.updateUserInfo();
                
                // Show welcome message
                setTimeout(() => {
                    const message = this.demoMode 
                        ? 'Welcome to Demo Mode! Add credit and debit entries to track your store finances.' 
                        : 'Welcome to Kirana Manager! Start by adding your first transaction.';
                    this.showNotification('Welcome!', message, 'info');
                }, 1000);
            },
            
            // Handle user registration
            handleRegister: function(storeName, ownerName, email, password) {
                // Show loading state
                const registerBtn = document.getElementById('register-submit-btn');
                const originalText = registerBtn.innerHTML;
                registerBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating Account...';
                registerBtn.disabled = true;
                
                // Create user with Firebase Authentication
                auth.createUserWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        const user = userCredential.user;
                        
                        // Create user data in Realtime Database
                        const userData = {
                            storeInfo: {
                                name: storeName,
                                owner: ownerName,
                                email: email,
                                address: "Enter your store address",
                                gst: "22XXXXX1234X1X5"
                            },
                            credits: {},
                            debits: {}
                        };
                        
                        return database.ref(`users/${user.uid}`).set(userData);
                    })
                    .then(() => {
                        this.showNotification('Account Created', 'Your account has been created successfully!', 'success');
                        
                        // Reset form
                        document.getElementById('register-form').reset();
                        
                        // Switch to login form
                        document.getElementById('register-form').style.display = 'none';
                        document.getElementById('login-form').style.display = 'block';
                    })
                    .catch((error) => {
                        console.error('Registration error:', error);
                        let errorMessage = "Registration failed. Please try again.";
                        
                        if (error.code === 'auth/email-already-in-use') {
                            errorMessage = "Email is already registered.";
                        } else if (error.code === 'auth/weak-password') {
                            errorMessage = "Password should be at least 6 characters.";
                        } else if (error.code === 'auth/invalid-email') {
                            errorMessage = "Invalid email address.";
                        } else if (error.code === 'auth/operation-not-allowed') {
                            errorMessage = "Email/password accounts are not enabled. Please enable Firebase Authentication in your project settings.";
                        } else if (error.code === 'auth/network-request-failed') {
                            errorMessage = "Network error. Please check your internet connection.";
                        } else if (error.code === 'auth/too-many-requests') {
                            errorMessage = "Too many requests. Please try again later.";
                        }
                        
                        this.showLoginError(errorMessage);
                        
                        // If Firebase auth fails, suggest demo mode
                        if (error.code.includes('auth/')) {
                            setTimeout(() => {
                                if (confirm('Having trouble with registration? Would you like to use Demo Mode instead?')) {
                                    this.useDemoCredentials();
                                }
                            }, 1500);
                        }
                    })
                    .finally(() => {
                        // Reset button state
                        registerBtn.innerHTML = originalText;
                        registerBtn.disabled = false;
                    });
            },
            
            // Handle user login
            handleLogin: function(email, password) {
                // Show loading state
                const loginBtn = document.getElementById('login-submit-btn');
                const originalText = loginBtn.innerHTML;
                loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Signing In...';
                loginBtn.disabled = true;
                
                // Check for demo credentials
                if (email === 'demo@kirana.com' && password === 'kirana123') {
                    // Use demo mode
                    setTimeout(() => {
                        this.enableDemoMode();
                        loginBtn.innerHTML = originalText;
                        loginBtn.disabled = false;
                    }, 1000);
                    return;
                }
                
                // Sign in with Firebase Authentication
                auth.signInWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        // Success - auth state listener will handle the rest
                        document.getElementById('login-form').reset();
                        document.getElementById('login-error').style.display = 'none';
                    })
                    .catch((error) => {
                        console.error('Login error:', error);
                        let errorMessage = "Login failed. Please check your credentials.";
                        if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
                            errorMessage = "Invalid email or password.";
                        } else if (error.code === 'auth/too-many-requests') {
                            errorMessage = "Too many failed attempts. Please try again later.";
                        } else if (error.code === 'auth/network-request-failed') {
                            errorMessage = "Network error. Please check your internet connection.";
                        } else if (error.code === 'auth/internal-error') {
                            errorMessage = "Server error. Please try again later.";
                        } else if (error.code === 'auth/operation-not-allowed') {
                            errorMessage = "Email/password accounts are not enabled. Please enable Firebase Authentication in your project settings.";
                        }
                        
                        this.showLoginError(errorMessage);
                        
                        // Suggest demo mode on auth errors
                        if (error.code.includes('auth/')) {
                            setTimeout(() => {
                                if (confirm('Having trouble logging in? Would you like to use Demo Mode instead?')) {
                                    this.useDemoCredentials();
                                }
                            }, 1500);
                        }
                    })
                    .finally(() => {
                        // Reset button state
                        loginBtn.innerHTML = originalText;
                        loginBtn.disabled = false;
                    });
            },
            
            // Use demo credentials
            useDemoCredentials: function() {
                document.getElementById('login-email').value = 'demo@kirana.com';
                document.getElementById('login-password').value = 'kirana123';
                document.getElementById('login-error').style.display = 'none';
            },
            
            // Handle logout
            handleLogout: function() {
                if (this.demoMode) {
                    this.demoMode = false;
                    localStorage.removeItem('kiranaDemoMode');
                    this.showLoginScreen();
                    this.showNotification('Logged Out', 'Demo session ended.', 'info');
                    return;
                }
                
                auth.signOut()
                    .then(() => {
                        this.showNotification('Logged Out', 'You have been signed out successfully.', 'info');
                    })
                    .catch((error) => {
                        console.error("Logout error:", error);
                        this.showNotification('Error', 'Failed to logout. Please try again.', 'danger');
                    });
            },
            
            // Show login error
            showLoginError: function(message) {
                const errorElement = document.getElementById('login-error');
                errorElement.textContent = message;
                errorElement.style.display = 'block';
            },
            
            // Update user info in UI
            updateUserInfo: function() {
                // Update avatar with first letter of store name
                const storeName = this.data.storeInfo.name || 'SK';
                document.getElementById('user-avatar').textContent = storeName.charAt(0).toUpperCase();
                
                // Update header info
                document.getElementById('store-name-header').textContent = this.data.storeInfo.name || 'Kirana Manager';
                document.getElementById('owner-name-header').textContent = this.data.storeInfo.owner || 'Store Owner';
                document.getElementById('user-email').textContent = this.currentUser ? this.currentUser.email : 'demo@kirana.com';
            },
            
            // Setup event listeners
            setupEventListeners: function() {
                // Login form
                document.getElementById('login-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const email = document.getElementById('login-email').value;
                    const password = document.getElementById('login-password').value;
                    
                    if (email && password) {
                        this.handleLogin(email, password);
                    }
                });
                
                // Register form
                document.getElementById('register-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const storeName = document.getElementById('register-store-name').value;
                    const ownerName = document.getElementById('register-owner-name').value;
                    const email = document.getElementById('register-email').value;
                    const password = document.getElementById('register-password').value;
                    const confirmPassword = document.getElementById('register-confirm-password').value;
                    
                    // Validation
                    if (!storeName || !ownerName || !email || !password || !confirmPassword) {
                        this.showLoginError('Please fill all fields.');
                        return;
                    }
                    
                    if (password !== confirmPassword) {
                        this.showLoginError('Passwords do not match.');
                        return;
                    }
                    
                    if (password.length < 6) {
                        this.showLoginError('Password must be at least 6 characters.');
                        return;
                    }
                    
                    this.handleRegister(storeName, ownerName, email, password);
                });
                
                // Toggle between login and register forms
                document.getElementById('show-register').addEventListener('click', () => {
                    document.getElementById('login-form').style.display = 'none';
                    document.getElementById('register-form').style.display = 'block';
                    document.getElementById('login-error').style.display = 'none';
                });
                
                document.getElementById('show-login').addEventListener('click', () => {
                    document.getElementById('register-form').style.display = 'none';
                    document.getElementById('login-form').style.display = 'block';
                    document.getElementById('login-error').style.display = 'none';
                });
                
                // Logout button
                document.getElementById('logout-btn').addEventListener('click', () => {
                    this.handleLogout();
                });
                
                // Bottom navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const screenId = item.getAttribute('data-screen');
                        this.switchScreen(screenId);
                    });
                });
                
                // Payment method buttons for credit
                document.querySelectorAll('#credit-screen [data-payment]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('#credit-screen [data-payment]').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                    });
                });
                
                // Payment method buttons for debit
                document.querySelectorAll('#debit-screen [data-payment]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('#debit-screen [data-payment]').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                    });
                });
                
                // Add credit button
                document.getElementById('add-credit-btn').addEventListener('click', () => this.addCredit());
                
                // Add debit button
                document.getElementById('add-debit-btn').addEventListener('click', () => this.addDebit());
                
                // Quick add credit buttons
                document.querySelectorAll('.quick-add-btn.credit').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const amount = e.currentTarget.getAttribute('data-amount');
                        document.getElementById('credit-amount').value = amount;
                        document.getElementById('credit-category').value = 'Sales';
                        document.getElementById('credit-description').value = 'Quick Sale';
                        this.switchScreen('credit-screen');
                    });
                });
                
                // Quick add debit buttons
                document.querySelectorAll('.quick-add-btn.debit').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const amount = e.currentTarget.getAttribute('data-amount');
                        document.getElementById('debit-amount').value = amount;
                        document.getElementById('debit-category').value = 'Purchase';
                        document.getElementById('debit-description').value = 'Quick Purchase';
                        this.switchScreen('debit-screen');
                    });
                });
            },
            
            // Switch between screens
            switchScreen: function(screenId) {
                // Hide all screens
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.remove('active');
                });
                
                // Show selected screen
                document.getElementById(screenId).classList.add('active');
                
                // Update active nav item
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                document.querySelector(`[data-screen="${screenId}"]`).classList.add('active');
                
                // Update screen content
                switch(screenId) {
                    case 'home-screen':
                        this.renderHomeScreen();
                        break;
                    case 'credit-screen':
                        this.renderCreditScreen();
                        break;
                    case 'debit-screen':
                        this.renderDebitScreen();
                        break;
                }
            },
            
            // Add credit transaction
            addCredit: function() {
                const amount = parseFloat(document.getElementById('credit-amount').value);
                const category = document.getElementById('credit-category').value;
                const description = document.getElementById('credit-description').value.trim();
                const customer = document.getElementById('credit-customer').value.trim();
                const paymentMethod = document.querySelector('#credit-screen [data-payment].active').getAttribute('data-payment');
                let date = document.getElementById('credit-date').value;
                
                // Use today's date if not specified
                if (!date) date = this.getTodayDate();
                
                // Validation
                if (!amount || amount <= 0) {
                    this.showNotification('Error', 'Please enter a valid amount', 'warning');
                    return;
                }
                
                if (!category) {
                    this.showNotification('Error', 'Please select a category', 'warning');
                    return;
                }
                
                if (!description) {
                    this.showNotification('Error', 'Please enter a description', 'warning');
                    return;
                }
                
                // Create new credit object
                const newCredit = {
                    amount: amount,
                    category: category,
                    description: description,
                    customer: customer || null,
                    paymentMethod: paymentMethod,
                    date: date,
                    timestamp: Date.now()
                };
                
                if (this.demoMode) {
                    // Add to demo data
                    const creditId = 'demo-credit-' + Date.now();
                    this.data.credits.push({
                        id: creditId,
                        ...newCredit
                    });
                    this.saveDemoData();
                    
                    // Clear form
                    document.getElementById('credit-amount').value = '';
                    document.getElementById('credit-description').value = '';
                    document.getElementById('credit-customer').value = '';
                    
                    // Refresh displays
                    this.renderHomeScreen();
                    this.renderCreditScreen();
                    
                    // Show success message
                    this.showNotification('Credit Added', `₹${amount} credit added successfully`, 'success');
                    
                    // Switch to home screen after a delay
                    setTimeout(() => {
                        this.switchScreen('home-screen');
                    }, 1500);
                } else {
                    // Add to Firebase
                    if (!this.userId) {
                        this.showNotification('Error', 'Please login to add credit', 'danger');
                        return;
                    }
                    
                    const newCreditRef = database.ref(`users/${this.userId}/credits`).push();
                    newCreditRef.set(newCredit)
                        .then(() => {
                            // Clear form
                            document.getElementById('credit-amount').value = '';
                            document.getElementById('credit-description').value = '';
                            document.getElementById('credit-customer').value = '';
                            
                            // Show success message
                            this.showNotification('Credit Added', `₹${amount} credit added successfully`, 'success');
                            
                            // Switch to home screen after a delay
                            setTimeout(() => {
                                this.switchScreen('home-screen');
                            }, 1500);
                        })
                        .catch((error) => {
                            console.error("Error adding credit:", error);
                            this.showNotification('Error', 'Failed to add credit. Please try again.', 'danger');
                        });
                }
            },
            
            // Add debit transaction
            addDebit: function() {
                const amount = parseFloat(document.getElementById('debit-amount').value);
                const category = document.getElementById('debit-category').value;
                const description = document.getElementById('debit-description').value.trim();
                const vendor = document.getElementById('debit-vendor').value.trim();
                const paymentMethod = document.querySelector('#debit-screen [data-payment].active').getAttribute('data-payment');
                let date = document.getElementById('debit-date').value;
                
                // Use today's date if not specified
                if (!date) date = this.getTodayDate();
                
                // Validation
                if (!amount || amount <= 0) {
                    this.showNotification('Error', 'Please enter a valid amount', 'warning');
                    return;
                }
                
                if (!category) {
                    this.showNotification('Error', 'Please select a category', 'warning');
                    return;
                }
                
                if (!description) {
                    this.showNotification('Error', 'Please enter a description', 'warning');
                    return;
                }
                
                // Create new debit object
                const newDebit = {
                    amount: amount,
                    category: category,
                    description: description,
                    vendor: vendor || null,
                    paymentMethod: paymentMethod,
                    date: date,
                    timestamp: Date.now()
                };
                
                if (this.demoMode) {
                    // Add to demo data
                    const debitId = 'demo-debit-' + Date.now();
                    this.data.debits.push({
                        id: debitId,
                        ...newDebit
                    });
                    this.saveDemoData();
                    
                    // Clear form
                    document.getElementById('debit-amount').value = '';
                    document.getElementById('debit-description').value = '';
                    document.getElementById('debit-vendor').value = '';
                    
                    // Refresh displays
                    this.renderHomeScreen();
                    this.renderDebitScreen();
                    
                    // Show success message
                    this.showNotification('Debit Added', `₹${amount} debit added successfully`, 'success');
                    
                    // Switch to home screen after a delay
                    setTimeout(() => {
                        this.switchScreen('home-screen');
                    }, 1500);
                } else {
                    // Add to Firebase
                    if (!this.userId) {
                        this.showNotification('Error', 'Please login to add debit', 'danger');
                        return;
                    }
                    
                    const newDebitRef = database.ref(`users/${this.userId}/debits`).push();
                    newDebitRef.set(newDebit)
                        .then(() => {
                            // Clear form
                            document.getElementById('debit-amount').value = '';
                            document.getElementById('debit-description').value = '';
                            document.getElementById('debit-vendor').value = '';
                            
                            // Show success message
                            this.showNotification('Debit Added', `₹${amount} debit added successfully`, 'success');
                            
                            // Switch to home screen after a delay
                            setTimeout(() => {
                                this.switchScreen('home-screen');
                            }, 1500);
                        })
                        .catch((error) => {
                            console.error("Error adding debit:", error);
                            this.showNotification('Error', 'Failed to add debit. Please try again.', 'danger');
                        });
                }
            },
            
            // Render home screen (Analysis)
            renderHomeScreen: function() {
                // Update current date
                this.updateCurrentDate();
                
                // Get today's date
                const today = this.getTodayDate();
                
                // Calculate today's totals
                const todayCredits = this.data.credits
                    .filter(credit => credit.date === today)
                    .reduce((sum, credit) => sum + credit.amount, 0);
                
                const todayDebits = this.data.debits
                    .filter(debit => debit.date === today)
                    .reduce((sum, debit) => sum + debit.amount, 0);
                
                const todayProfit = todayCredits - todayDebits;
                
                // Calculate total totals
                const totalCredits = this.data.credits
                    .reduce((sum, credit) => sum + credit.amount, 0);
                
                const totalDebits = this.data.debits
                    .reduce((sum, debit) => sum + debit.amount, 0);
                
                const totalProfit = totalCredits - totalDebits;
                
                // Calculate monthly totals
                const currentMonth = this.getCurrentMonth();
                const monthlyCredits = this.data.credits
                    .filter(credit => credit.date.startsWith(currentMonth))
                    .reduce((sum, credit) => sum + credit.amount, 0);
                
                const monthlyDebits = this.data.debits
                    .filter(debit => debit.date.startsWith(currentMonth))
                    .reduce((sum, debit) => sum + debit.amount, 0);
                
                const monthlyProfit = monthlyCredits - monthlyDebits;
                
                const monthTransactions = this.data.credits
                    .filter(credit => credit.date.startsWith(currentMonth)).length +
                    this.data.debits.filter(debit => debit.date.startsWith(currentMonth)).length;
                
                // Update summary
                document.getElementById('today-credit').textContent = todayCredits.toFixed(0);
                document.getElementById('today-debit').textContent = todayDebits.toFixed(0);
                document.getElementById('today-profit').textContent = todayProfit.toFixed(0);
                
                // Update stats
                document.getElementById('total-credit').textContent = totalCredits.toFixed(0);
                document.getElementById('total-debit').textContent = totalDebits.toFixed(0);
                document.getElementById('monthly-profit').textContent = monthlyProfit.toFixed(0);
                document.getElementById('month-transactions').textContent = monthTransactions;
                
                // Update recent transactions
                this.updateRecentTransactions();
                
                // Update charts
                this.updateHomeCharts();
            },
            
            // Render credit screen
            renderCreditScreen: function() {
                // Get today's date
                const today = this.getTodayDate();
                
                // Filter today's credits
                const todayCredits = this.data.credits.filter(credit => credit.date === today);
                
                // Update count
                document.getElementById('today-credit-count').textContent = todayCredits.length;
                
                // Display today's credits
                const creditListContainer = document.getElementById('today-credit-list');
                
                if (todayCredits.length > 0) {
                    let html = '';
                    todayCredits.slice().reverse().forEach(credit => {
                        const paymentIcons = {
                            cash: 'fa-money-bill',
                            upi: 'fa-mobile-alt',
                            card: 'fa-credit-card',
                            online: 'fa-globe'
                        };
                        
                        html += `
                            <div class="transaction-item">
                                <div class="transaction-info">
                                    <h4>${credit.description}</h4>
                                    <p>${credit.category} | <i class="fas ${paymentIcons[credit.paymentMethod]}" style="margin: 0 5px;"></i> ${credit.paymentMethod.toUpperCase()}</p>
                                    ${credit.customer ? `<p style="font-size: 0.8rem;">Customer: ${credit.customer}</p>` : ''}
                                </div>
                                <div class="transaction-amount credit currency">${credit.amount}</div>
                            </div>
                        `;
                    });
                    
                    creditListContainer.innerHTML = html;
                } else {
                    creditListContainer.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-arrow-down empty-state-icon"></i>
                            <div class="empty-state-title">No credit entries today</div>
                            <p>Add your first credit entry above</p>
                        </div>
                    `;
                }
            },
            
            // Render debit screen
            renderDebitScreen: function() {
                // Get today's date
                const today = this.getTodayDate();
                
                // Filter today's debits
                const todayDebits = this.data.debits.filter(debit => debit.date === today);
                
                // Update count
                document.getElementById('today-debit-count').textContent = todayDebits.length;
                
                // Display today's debits
                const debitListContainer = document.getElementById('today-debit-list');
                
                if (todayDebits.length > 0) {
                    let html = '';
                    todayDebits.slice().reverse().forEach(debit => {
                        const paymentIcons = {
                            cash: 'fa-money-bill',
                            upi: 'fa-mobile-alt',
                            card: 'fa-credit-card',
                            online: 'fa-globe'
                        };
                        
                        html += `
                            <div class="transaction-item debit">
                                <div class="transaction-info">
                                    <h4>${debit.description}</h4>
                                    <p>${debit.category} | <i class="fas ${paymentIcons[debit.paymentMethod]}" style="margin: 0 5px;"></i> ${debit.paymentMethod.toUpperCase()}</p>
                                    ${debit.vendor ? `<p style="font-size: 0.8rem;">Vendor: ${debit.vendor}</p>` : ''}
                                </div>
                                <div class="transaction-amount debit currency">${debit.amount}</div>
                            </div>
                        `;
                    });
                    
                    debitListContainer.innerHTML = html;
                } else {
                    debitListContainer.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-arrow-up empty-state-icon"></i>
                            <div class="empty-state-title">No debit entries today</div>
                            <p>Add your first debit entry above</p>
                        </div>
                    `;
                }
            },
            
            // Update recent transactions on home screen
            updateRecentTransactions: function() {
                const container = document.getElementById('recent-transactions');
                
                // Combine and sort credits and debits by timestamp
                const allTransactions = [
                    ...this.data.credits.map(t => ({ ...t, type: 'credit' })),
                    ...this.data.debits.map(t => ({ ...t, type: 'debit' }))
                ].sort((a, b) => b.timestamp - a.timestamp).slice(0, 5);
                
                if (allTransactions.length > 0) {
                    let html = '';
                    allTransactions.forEach(transaction => {
                        const isCredit = transaction.type === 'credit';
                        const paymentIcons = {
                            cash: 'fa-money-bill',
                            upi: 'fa-mobile-alt',
                            card: 'fa-credit-card',
                            online: 'fa-globe'
                        };
                        
                        html += `
                            <div class="transaction-item ${isCredit ? '' : 'debit'}">
                                <div class="transaction-info">
                                    <h4>${transaction.description}</h4>
                                    <p>${transaction.category} | ${transaction.date} | <i class="fas ${paymentIcons[transaction.paymentMethod]}" style="margin: 0 5px;"></i> ${transaction.paymentMethod.toUpperCase()}</p>
                                </div>
                                <div class="transaction-amount ${isCredit ? 'credit' : 'debit'} currency">${transaction.amount}</div>
                            </div>
                        `;
                    });
                    
                    container.innerHTML = html;
                } else {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-exchange-alt empty-state-icon"></i>
                            <div class="empty-state-title">No transactions yet</div>
                            <p>Add your first credit or debit transaction</p>
                        </div>
                    `;
                }
            },
            
            // Setup charts
            setupCharts: function() {
                this.updateHomeCharts();
            },
            
            // Update home screen charts
            updateHomeCharts: function() {
                // Income vs Expense chart (last 7 days)
                const incomeExpenseCtx = document.getElementById('incomeExpenseChart');
                if (incomeExpenseCtx) {
                    // Destroy existing chart
                    if (this.charts.incomeExpenseChart) {
                        this.charts.incomeExpenseChart.destroy();
                    }
                    
                    const last7Days = this.getLast7Days();
                    const incomeData = last7Days.map(day => {
                        const dayCredits = this.data.credits.filter(credit => credit.date === day);
                        return dayCredits.reduce((sum, credit) => sum + credit.amount, 0);
                    });
                    
                    const expenseData = last7Days.map(day => {
                        const dayDebits = this.data.debits.filter(debit => debit.date === day);
                        return dayDebits.reduce((sum, debit) => sum + debit.amount, 0);
                    });
                    
                    this.charts.incomeExpenseChart = new Chart(incomeExpenseCtx, {
                        type: 'bar',
                        data: {
                            labels: last7Days.map(day => this.formatDateForDisplay(day)),
                            datasets: [
                                {
                                    label: 'Income (Credit)',
                                    data: incomeData,
                                    backgroundColor: 'rgba(16, 185, 129, 0.7)',
                                    borderColor: 'rgb(16, 185, 129)',
                                    borderWidth: 1
                                },
                                {
                                    label: 'Expenses (Debit)',
                                    data: expenseData,
                                    backgroundColor: 'rgba(239, 68, 68, 0.7)',
                                    borderColor: 'rgb(239, 68, 68)',
                                    borderWidth: 1
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return '₹' + value;
                                        }
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    position: 'top',
                                }
                            }
                        }
                    });
                }
                
                // Category chart
                const categoryCtx = document.getElementById('categoryChart');
                if (categoryCtx) {
                    // Destroy existing chart
                    if (this.charts.categoryChart) {
                        this.charts.categoryChart.destroy();
                    }
                    
                    // Calculate category-wise totals for credits
                    const creditCategories = {};
                    this.data.credits.forEach(credit => {
                        if (!creditCategories[credit.category]) {
                            creditCategories[credit.category] = 0;
                        }
                        creditCategories[credit.category] += credit.amount;
                    });
                    
                    // Calculate category-wise totals for debits
                    const debitCategories = {};
                    this.data.debits.forEach(debit => {
                        if (!debitCategories[debit.category]) {
                            debitCategories[debit.category] = 0;
                        }
                        debitCategories[debit.category] += debit.amount;
                    });
                    
                    // Combine top categories
                    const allCategories = { ...creditCategories, ...debitCategories };
                    const sortedCategories = Object.keys(allCategories)
                        .sort((a, b) => allCategories[b] - allCategories[a])
                        .slice(0, 5);
                    
                    const categoryData = sortedCategories.map(cat => allCategories[cat]);
                    
                    this.charts.categoryChart = new Chart(categoryCtx, {
                        type: 'doughnut',
                        data: {
                            labels: sortedCategories,
                            datasets: [{
                                data: categoryData,
                                backgroundColor: [
                                    'rgba(79, 70, 229, 0.8)',
                                    'rgba(16, 185, 129, 0.8)',
                                    'rgba(245, 158, 11, 0.8)',
                                    'rgba(239, 68, 68, 0.8)',
                                    'rgba(139, 92, 246, 0.8)'
                                ],
                                borderWidth: 0,
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                }
                            }
                        }
                    });
                }
            },
            
            // Helper functions
            getTodayDate: function() {
                const today = new Date();
                return today.toISOString().split('T')[0];
            },
            
            getCurrentMonth: function() {
                const today = new Date();
                return today.toISOString().substring(0, 7); // YYYY-MM
            },
            
            getLast7Days: function() {
                const days = [];
                for (let i = 6; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    days.push(date.toISOString().split('T')[0]);
                }
                return days;
            },
            
            formatDateForDisplay: function(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-IN', { day: 'numeric', month: 'short' });
            },
            
            updateCurrentDate: function() {
                const today = new Date();
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                document.getElementById('current-date').textContent = today.toLocaleDateString('en-IN', options);
            },
            
            // Show notification
            showNotification: function(title, message, type = 'success') {
                const notification = document.getElementById('notification');
                const icon = notification.querySelector('i');
                const titleElement = document.getElementById('notification-title');
                const messageElement = document.getElementById('notification-message');
                
                // Set notification content
                titleElement.textContent = title;
                messageElement.textContent = message;
                
                // Set icon and color based on type
                if (type === 'success') {
                    icon.className = 'fas fa-check-circle';
                    icon.style.color = 'var(--success)';
                    notification.style.borderLeftColor = 'var(--success)';
                } else if (type === 'warning') {
                    icon.className = 'fas fa-exclamation-triangle';
                    icon.style.color = 'var(--warning)';
                    notification.style.borderLeftColor = 'var(--warning)';
                } else if (type === 'danger') {
                    icon.className = 'fas fa-times-circle';
                    icon.style.color = 'var(--danger)';
                    notification.style.borderLeftColor = 'var(--danger)';
                } else {
                    icon.className = 'fas fa-info-circle';
                    icon.style.color = 'var(--primary)';
                    notification.style.borderLeftColor = 'var(--primary)';
                }
                
                // Show notification
                notification.classList.remove('hidden');
                
                // Auto hide after 3 seconds
                setTimeout(() => {
                    notification.classList.add('hidden');
                }, 3000);
            }
        };
        
        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            KiranaApp.init();
        });
    </script>
</body>
</html>

